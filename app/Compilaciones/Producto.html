










{% extends "Herencia.html" %}
{% load static %}

{% block title %}25 Urban Store - Administración{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'style/producto/Administracion.css' %}" />
{% endblock %}

{% block content %}
<section class="admin-panel-container">
    <div class="container">
        <div class="row mb-5">
            <div class="col-12 text-center">
                <h1 class="urban-title">ZONA DE ADMINISTRACIÓN</h1>
                <p class="urban-subtitle">GESTIONA TU IMPERIO URBAN</p>
            </div>
        </div>

        <div class="row justify-content-center g-4">
            
            <div class="col-12 col-md-6 col-lg-4">
                <div class="urban-card">
                    <div class="card-img-wrapper">
                        <img src="{% static 'img/producto/agregar-producto.png' %}" class="urban-img" alt="Agregar Producto">
                    </div>
                    <div class="card-body text-center">
                        <h3 class="card-title">NUEVO DROP</h3>
                        <a href="{% url 'agregar_producto' %}" class="btn urban-btn">AGREGAR PRODUCTO</a>
                    </div>
                </div>
            </div>
            
            <div class="col-12 col-md-6 col-lg-4">
                <div class="urban-card">
                    <div class="card-img-wrapper">
                        <img src="{% static 'img/producto/modificar-producto.png' %}" class="urban-img" alt="Modificar Producto">
                    </div>
                    <div class="card-body text-center">
                        <h3 class="card-title">EDITAR STOCK</h3>
                        <a href="{% url 'modificar' %}" class="btn urban-btn">MODIFICAR PRODUCTO</a>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-6 col-lg-4">
                <div class="urban-card">
                    <div class="card-img-wrapper">
                        <img src="{% static 'img/producto/eliminar-producto.png' %}" class="urban-img" alt="Eliminar Producto">
                    </div>
                    <div class="card-body text-center">
                        <h3 class="card-title">LIMPIAR INVENTARIO</h3>
                        <a href="{% url 'eliminar' %}" class="btn urban-btn btn-danger-custom">ELIMINAR PRODUCTO</a>
                    </div>
                </div>
            </div>
            
            <div class="col-12 col-md-6 col-lg-4">
                <div class="urban-card">
                    <div class="card-img-wrapper">
                        <img src="{% static 'img/producto/listar-producto.png' %}" class="urban-img" alt="Agregar Marca">
                    </div>
                    <div class="card-body text-center">
                        <h3 class="card-title">NUEVA MARCA</h3>
                        <a href="{% url 'agrega_marca' %}" class="btn urban-btn">AGREGAR MARCA</a>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-6 col-lg-4">
                <div class="urban-card">
                    <div class="card-img-wrapper">
                        <img src="{% static 'img/producto/agregar_tienda.png' %}" class="urban-img" alt="Agregar Tienda">
                    </div>
                    <div class="card-body text-center">
                        <h3 class="card-title">EXPANDIR TERRITORIO</h3>
                        <a href="{% url 'agregar_tienda' %}" class="btn urban-btn">AGREGAR SPOT</a>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-6 col-lg-4">
                <div class="urban-card">
                    <div class="card-img-wrapper">
                         <div class="icon-placeholder">
                            <i class="fas fa-users" style="font-size: 5rem; color: #5DD62C;"></i>
                        </div>
                    </div>
                    <div class="card-body text-center">
                        <h3 class="card-title">CREW & CLIENTES</h3>
                        <a href="{% url 'Admin_User' %}" class="btn urban-btn">GESTIONAR USUARIOS</a>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
{% endblock %}

{# Añade JavaScript específico si es necesario #}
{% block extra_js %}
<script src="{% static 'js/Administracion.js' %}"></script>
{% endblock %}  






{% extends "Herencia.html" %}
{% load static %}

{% block title %}25 Urban Store - Agregar Producto{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'style/producto/agregar.css' %}" />
{% endblock %}

{% block content %}

<div class="page-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="form-container">
                    
                    <div class="card-header text-center">
                        <h2>Agregar Nuevo Item</h2>
                    </div>

                    <div class="text-end">
                        <span class="user-badge">
                            <i class="fas fa-user-tag"></i> Upload by: {{ user.username|default:"Admin" }}
                        </span>
                    </div>

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.tipo.id_for_label }}" class="form-label">Tipo de Producto</label>
                                {{ form.tipo }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.marca.id_for_label }}" class="form-label">Marca</label>
                                {{ form.marca }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="{{ form.modelo.id_for_label }}" class="form-label">Modelo</label>
                                {{ form.modelo }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.precio.id_for_label }}" class="form-label">Precio ($)</label>
                                {{ form.precio }}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.descripcion.id_for_label }}" class="form-label">Descripción Detallada</label>
                            {{ form.descripcion }}
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.cantidad.id_for_label }}" class="form-label">Stock</label>
                                {{ form.cantidad }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.genero.id_for_label }}" class="form-label">Género</label>
                                {{ form.genero }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="{{ form.color.id_for_label }}" class="form-label">Color</label>
                                {{ form.color }}
                            </div>
                        </div>

                        <div class="mb-4 form-check">
                            {{ form.nuevo }}
                            <label for="{{ form.nuevo.id_for_label }}" class="form-check-label">¿Es colección nueva?</label>
                        </div>
                        
                        <div class="mb-4" id="imagen-field">
                            <label for="{{ form.imagen.id_for_label }}" class="form-label">Fotografía del Producto</label>
                            {{ form.imagen }}
                        </div>
                        
                        <div class="p-3 mb-3 border border-secondary" style="background-color: rgba(0,0,0,0.3);">
                            <div class="mb-3" id="tipo-accesorio-field" style="display: none;">
                                <label for="{{ form.tipo_accesorio.id_for_label }}" class="form-label text-success">Tipo de Accesorio</label>
                                {{ form.tipo_accesorio }}
                            </div>
                            <div class="mb-3" id="subcategoria-tronco-field" style="display: none;">
                                <label for="{{ form.subcategoria_tronco.id_for_label }}" class="form-label text-success">Subcategoría (Superior)</label>
                                {{ form.subcategoria_tronco }}
                            </div>

                            <div class="mb-3" id="subcategoria-piernas-field" style="display: none;">
                                <label for="{{ form.subcategoria_piernas.id_for_label }}" class="form-label text-success">Subcategoría (Inferior)</label>
                                {{ form.subcategoria_piernas }}
                            </div>

                            <div class="mb-3" id="subcategoria-zapatos-field" style="display: none;">
                                <label for="{{ form.subcategoria_zapatos.id_for_label }}" class="form-label text-success">Subcategoría (Calzado)</label>
                                {{ form.subcategoria_zapatos }}
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 mt-5">
                            <button type="submit" class="btn btn-primary py-3">Guardar en Inventario</button>
                            <a href="{% url 'Administracion' %}" class="btn btn-secondary py-2">Cancelar Operación</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/agregar.js' %}"></script>
{% endblock %}






{% extends "Herencia.html" %}
{% load static %}

{% block title %}25 Urban Store - Agregar Tienda{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'style/producto/agregar_tienda.css' %}">
{% endblock %}

{% block content %}
<div class="urban-container">
    <div class="glass-card">
        <h1 class="urban-title">NUEVA TIENDA</h1>
        <p class="urban-subtitle">DEFINE TU TERRITORIO</p>

        <form method="post" class="urban-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="nombre_tienda" class="urban-label">NOMBRE DEL SPOT</label>
                <div class="input-wrapper">
                    <input type="text" id="nombre_tienda" name="nombre_tienda" class="urban-input" placeholder="Ej: Zona Norte, Outlet Maipú..." required>
                    <span class="focus-border"></span>
                </div>
            </div>

            <div class="form-group">
                <label class="urban-label">¿QUÉ MUEVES AQUÍ?</label>
                <div class="checkbox-grid">
                    
                    <label class="custom-checkbox">
                        <input type="checkbox" name="categorias" value="Torso">
                        <span class="checkmark"></span>
                        <i class="category-icon fas fa-tshirt"></i>
                        <span class="label-text">TORSO</span>
                    </label>

                    <label class="custom-checkbox">
                        <input type="checkbox" name="categorias" value="Pantalones">
                        <span class="checkmark"></span>
                        <i class="category-icon fas fa-socks"></i>
                        <span class="label-text">PANTALONES</span>
                    </label>

                    <label class="custom-checkbox">
                        <input type="checkbox" name="categorias" value="Calzado">
                        <span class="checkmark"></span>
                        <i class="category-icon fas fa-shoe-prints"></i>
                        <span class="label-text">CALZADO</span>
                    </label>

                    <label class="custom-checkbox">
                        <input type="checkbox" name="categorias" value="Accesorios">
                        <span class="checkmark"></span>
                        <i class="category-icon fas fa-hat-cowboy"></i>
                        <span class="label-text">ACCESORIOS</span>
                    </label>

                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="urban-btn">
                    CREAR TIENDA <span class="btn-icon">➜</span>
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/agregar_tienda.js' %}"></script>
{% endblock %}






{% extends "Herencia.html" %}
{% load static %}

{% block title %}25 Urban Store - Agregar Marca{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'style/producto/agregar_marcas.css' %}">
{% endblock %}

{% block content %}
<section class="urban-container">
    <div class="container">
        <div class="row justify-content-center">
            
            <div class="col-12 col-lg-6 mb-5">
                <div class="urban-card form-card">
                    <div class="card-header-urban text-center">
                        <h2 class="urban-title">NUEVA MARCA</h2>
                        <p class="urban-subtitle">REGISTRA UNA NUEVA FIRMA EN EL SISTEMA</p>
                    </div>
                    
                    <div class="card-body-urban">
                        <form method="POST" action="{% url 'agrega_marca' %}">
                            {% csrf_token %}
                            
                            <div class="mb-4">
                                <label for="{{ form.nombre.id_for_label }}" class="urban-label">NOMBRE DE LA MARCA</label>
                                <div class="input-wrapper">
                                    {{ form.nombre }}
                                </div>
                                {% if form.nombre.errors %}
                                    <div class="urban-alert mt-2">
                                        {{ form.nombre.errors }}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-4 text-center">
                                <small class="user-badge">
                                    OPERADOR: <span>{{ user.username|upper }}</span>
                                </small>
                            </div>

                            <div class="d-grid gap-3 actions-panel">
                                <button type="submit" class="btn urban-btn save-btn">REGISTRAR MARCA</button>
                                <a href="{% url 'Administracion' %}" class="btn urban-btn cancel-btn">VOLVER AL PANEL</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-12">
                <div class="urban-card table-card">
                    <h3 class="urban-section-title">REGISTRO GLOBAL DE MARCAS</h3>
                    
                    <div class="urban-table-responsive">
                        <table class="urban-table">
                            <thead>
                                <tr>
                                    <th>MARCA</th>
                                    <th>CREADA POR</th>
                                    <th>SPOT ASOCIADO (ACTUAL)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for marca in marcas %}
                                    <tr>
                                        <td class="brand-name">{{ marca.nombre|upper }}</td>
                                        <td class="user-info">
                                            <i class="fas fa-user-circle"></i> {{ marca.usuario.username|default:"SISTEMA" }}
                                        </td>
                                        <td class="store-info">
                                            {# LÓGICA DE ACTUALIZACIÓN AUTOMÁTICA #}
                                            {% if marca.usuario.preferencias.tienda_asociada %}
                                                {# Muestra la tienda donde trabaja el usuario AHORA #}
                                                <span class="store-tag">{{ marca.usuario.preferencias.tienda_asociada.nombre_tienda|upper }}</span>
                                            {% elif marca.tienda %}
                                                {# Respaldo: Muestra la tienda donde se creó (histórico) #}
                                                <span class="store-tag" style="opacity: 0.7;">{{ marca.tienda.nombre_tienda|upper }} (HIST.)</span>
                                            {% else %}
                                                <span class="no-store">SIN SPOT</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="3" class="text-center py-4">NO HAY MARCAS REGISTRADAS EN LA BASE DE DATOS</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/agrega_marca.js' %}"></script>
{% endblock %}






{% extends "Herencia.html" %}
{% load static %}

{% block title %}25 Urban Store - Eliminar Productos{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{% static 'style/producto/eliminar.css' %}" />
{% endblock %}

{% block content %}
<div class="urban-wrapper">
    <div class="container urban-container mt-4 mb-5">
        
        <h2 class="page-title text-center mb-4">GESTIÓN DE INVENTARIO <span class="text-accent">/ ELIMINAR</span></h2>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-urban fade show" role="alert">
                    <span class="alert-icon">!</span> {{ message }}
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}

        <div class="urban-card p-4">
            
            <div class="d-flex justify-content-end mb-2">
                <div class="admin-badge">
                    <i class="bi bi-person-fill"></i> UPLOAD BY: {{ request.user.username|upper|default:"ADMIN" }}
                </div>
            </div>

            <form method="post" class="mb-4 dashed-bottom pb-4">
                {% csrf_token %}
                <div class="row align-items-end g-3">
                    <div class="col-md-9">
                        <label for="tipo_producto" class="urban-label">CATEGORÍA A GESTIONAR</label>
                        <select name="tipo_producto" id="tipo_producto" class="form-select urban-input" required>
                            <option value="" selected disabled>-- SELECCIONA EL TIPO DE PRODUCTO --</option>
                            <option value="Tronco" {% if tipo_producto == 'Tronco' %}selected{% endif %}>Torso</option>
                            <option value="Piernas" {% if tipo_producto == 'Piernas' %}selected{% endif %}>Pantalones</option>
                            <option value="Zapatos" {% if tipo_producto == 'Zapatos' %}selected{% endif %}>Calzado</option>
                            <option value="Complemento" {% if tipo_producto == 'Complemento' %}selected{% endif %}>Accesorios</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" name="listar" class="btn urban-btn-primary w-100">
                            CARGAR LISTA
                        </button>
                    </div>
                </div>
            </form>

            {% if productos %}
            <form method="post" id="eliminarForm">
                {% csrf_token %}
                <input type="hidden" name="tipo_producto" value="{{ tipo_producto }}">

                <div class="mb-4">
                    <label class="urban-label mb-2">ITEMS EN STOCK (SELECCIONA PARA ELIMINAR)</label>
                    <div class="table-responsive urban-table-container">
                        <table class="table urban-table mb-0">
                            <thead>
                                <tr>
                                    <th scope="col" class="text-center" style="width: 50px;">
                                        <input type="checkbox" id="selectAll" class="form-check-input urban-check">
                                    </th>
                                    <th scope="col">IMAGEN</th>
                                    <th scope="col">MODELO</th>
                                    <th scope="col">MARCA</th>
                                    <th scope="col">PRECIO ($)</th>
                                    <th scope="col">STOCK</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for producto in productos %}
                                    <tr>
                                        <td class="text-center align-middle">
                                            <input type="checkbox" name="seleccionados" value="{{ producto.id }}" class="form-check-input urban-check product-checkbox">
                                        </td>
                                        <td class="align-middle">
                                            <div class="img-box">
                                                {% if producto.imagen %}
                                                    <img src="{{ producto.imagen.url }}" alt="Prod" class="img-fluid">
                                                {% else %}
                                                    <span>N/A</span>
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td class="align-middle text-white">{{ producto.modelo|default:"--" }}</td>
                                        <td class="align-middle text-accent">{{ producto.marca }}</td>
                                        <td class="align-middle">${{ producto.precio }}</td>
                                        <td class="align-middle">{{ producto.cantidad }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="d-grid gap-3 d-md-block">
                    <button type="button" class="btn urban-btn-primary" id="eliminarSeleccionados">
                        ELIMINAR SELECCIONADOS
                    </button>
                    <button type="button" class="btn urban-btn-secondary" id="eliminarTodos">
                        ELIMINAR TODOS (CATEGORÍA)
                    </button>
                </div>
            </form>
            {% endif %}
            
        </div>

        <div class="urban-card p-4 mt-5">
            <h4 class="urban-label text-accent mb-3" style="border-bottom: 1px dashed #5DD62C; padding-bottom: 10px;">
                PAPELERA / HISTORIAL DE BAJAS
            </h4>
            
            <div class="table-responsive urban-table-container">
                <table class="table urban-table mb-0">
                    <thead>
                        <tr>
                            <th scope="col">FECHA BAJA</th>
                            <th scope="col">MODELO</th>
                            <th scope="col">MARCA</th>
                            <th scope="col">ELIMINADO POR</th>
                            <th scope="col">MOTIVO</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for baja in historial_bajas %}
                            <tr>
                                <td class="align-middle text-white">{{ baja.fecha|date:"d/m/Y H:i" }}</td>
                                <td class="align-middle text-white fw-bold">{{ baja.producto_modelo }}</td>
                                <td class="align-middle text-accent">{{ baja.marca }}</td>
                                <td class="align-middle">{{ baja.usuario.username|default:"Sistema"|upper }}</td>
                                <td class="align-middle text-muted small">{{ baja.motivo }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-4 text-muted fst-italic">
                                    No hay registros de eliminaciones recientes.
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/eliminar.js' %}"></script>
{% endblock %}






{% extends "Herencia.html" %}
{% load static %}

{% block title %}25 Urban Store - Modificar Productos{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="{% static 'style/producto/modificar.css' %}" />
{% endblock %}

{% block content %}
<div class="urban-wrapper">
    <div class="container py-5">
        <h2 class="text-center urban-title mb-5">MODIFICAR PRODUCTOS</h2>
        
        <div class="urban-card mb-5">
            <form id="productTypeForm" method="POST" action="{% url 'modificar' %}">
                {% csrf_token %}
                <div class="row align-items-end g-3">
                    <div class="col-md-8">
                        <label for="tipo_producto" class="urban-label mb-2">SELECCIONA CATEGORÍA</label>
                        <select class="form-select urban-select" id="tipo_producto" name="tipo_producto" required>
                            <option value="" selected disabled>-- ¿Qué vas a editar? --</option>
                            <option value="Tronco">Torso (Poleras/Camisas)</option>
                            <option value="Piernas">Pantalones/Jeans</option>
                            <option value="Zapatos">Calzado</option>
                            <option value="Complemento">Accesorios</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn urban-btn w-100" name="listar">
                            BUSCAR PRODUCTOS
                        </button>
                    </div>
                </div>
            </form>
        </div>
        
        {% if productos %}
        <div class="product-list-section fade-in">
            <h4 class="urban-subtitle mb-4">CATÁLOGO: <span class="text-urban">{{ tipo_producto|upper }}</span></h4>
            
            <form id="modifyForm" method="POST" action="{% url 'modificar' %}">
                {% csrf_token %}
                <input type="hidden" name="tipo_producto" value="{{ tipo_producto }}">
                
                <div class="row g-4">
                    {% for producto in productos %}
                    <div class="col-md-6 col-lg-4">
                        <div class="product-card-wrapper">
                            <input class="product-radio" type="radio" name="producto_id" 
                                   id="producto_{{ producto.id }}" value="{{ producto.id }}" required>
                            
                            <label class="product-card-content" for="producto_{{ producto.id }}">
                                <div class="card-img-top">
                                    {% if producto.imagen %}
                                    <img src="{{ producto.imagen.url }}" alt="{{ producto.modelo }}">
                                    {% else %}
                                    <div class="no-image">SIN FOTO</div>
                                    {% endif %}
                                </div>
                                <div class="card-body p-3">
                                    <h5 class="card-title text-urban">{{ producto.modelo|default:"Sin Modelo" }}</h5>
                                    <p class="card-price">${{ producto.precio }}</p>
                                    <div class="card-details">
                                        <span>Marca: {{ producto.marca }}</span>
                                        <span>Stock: {{ producto.cantidad }}</span>
                                    </div>
                                    <div class="d-none data-store">
                                        <p class="data-marca">{{ producto.marca }}</p>
                                        <p class="data-genero">{{ producto.get_genero_display }}</p>
                                        <p class="data-color">{{ producto.get_color_display }}</p>
                                        {% if producto.subcategoria %}
                                        <p class="data-subcat">{{ producto.get_subcategoria_display }}</p>
                                        {% endif %}
                                        {% if producto.tipo %}
                                        <p class="data-tipo">{{ producto.get_tipo_display }}</p>
                                        {% endif %}
                                        <p class="data-desc">{{ producto.descripcion }}</p>
                                        <p class="data-nuevo">{{ producto.nuevo|yesno:"true,false" }}</p>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="text-center mt-5">
                    <button type="button" class="btn urban-btn-outline btn-lg" id="btnModificar">
                        EDITAR SELECCIONADO
                    </button>
                </div>
            </form>
        </div>
        {% endif %}
        
        <div class="urban-modal" id="confirmationModal">
            <div class="urban-modal-content">
                <h4 class="urban-subtitle mb-3">¿CONFIRMAR EDICIÓN?</h4>
                <p class="text-light">Vas a entrar al modo edición del producto seleccionado.</p>
                <div class="d-flex justify-content-center gap-3 mt-4">
                    <button type="button" class="btn btn-secondary" id="cancelModal">Cancelar</button>
                    <button type="button" class="btn urban-btn" id="confirmModify">Confirmar</button>
                </div>
            </div>
        </div>
        
        <div class="modification-form mt-5" id="modificationForm" style="display: none;">
            <div class="urban-card border-urban">
                <h4 class="urban-title text-center mb-4">EDITOR DE PRODUCTO</h4>
                <form id="editProductForm" method="POST" action="{% url 'modificar' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="actualizar" value="true">
                    <input type="hidden" name="tipo_producto" id="editTipoProducto">
                    <input type="hidden" name="producto_id" id="editProductoId">
                    
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="user-audit-badge">
                                <span class="label">MODIFICANDO COMO:</span>
                                <span class="username">{{ user.username|upper }}</span>
                                <input type="hidden" name="usuario_modificador" value="{{ user.id }}">
                            </div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="editModelo" class="urban-label">MODELO</label>
                                <input type="text" class="form-control urban-input" id="editModelo" name="modelo" required>
                            </div>
                            
                            <div class="form-group mt-3">
                                <label for="editPrecio" class="urban-label">PRECIO ($)</label>
                                <input type="number" class="form-control urban-input" id="editPrecio" name="precio" required>
                            </div>

                            <div class="form-group mt-3">
                                <label for="editCantidad" class="urban-label">STOCK DISPONIBLE</label>
                                <input type="number" class="form-control urban-input" id="editCantidad" name="cantidad" min="0" value="0">
                            </div>
                            
                            <div class="form-group mt-3">
                                <label for="editMarca" class="urban-label">MARCA</label>
                                <select class="form-select urban-select" id="editMarca" name="marca" required>
                                    {% for marca in marcas %}
                                    <option value="{{ marca.id }}">{{ marca.nombre }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-6">
                                    <label for="editGenero" class="urban-label">GÉNERO</label>
                                    <select class="form-select urban-select" id="editGenero" name="genero" required>
                                        {% for value, display in GENERO_CHOICES %}
                                        <option value="{{ value }}">{{ display }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label for="editColor" class="urban-label">COLOR</label>
                                    <select class="form-select urban-select" id="editColor" name="color" required>
                                        {% for value, display in COLOR_CHOICES %}
                                        <option value="{{ value }}">{{ display }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="editDescripcion" class="urban-label">DESCRIPCIÓN</label>
                                <textarea class="form-control urban-input" id="editDescripcion" name="descripcion" rows="4" required></textarea>
                            </div>
                            
                            <div class="form-group form-check mt-3">
                                <input type="checkbox" class="form-check-input urban-check" id="editNuevo" name="nuevo">
                                <label class="form-check-label text-light" for="editNuevo">¿Marcar como Nuevo?</label>
                            </div>
                            
                            <div class="form-group mt-3" id="subcategoriaGroup" style="display: none;">
                                <label for="editSubcategoria" class="urban-label">SUBCATEGORÍA</label>
                                <select class="form-select urban-select" id="editSubcategoria" name="subcategoria">
                                    {% for value, display in SUBCATEGORIA_TRONCO %}
                                        <option value="{{ value }}">{{ display }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="form-group mt-3" id="tipoAccesorioGroup" style="display: none;">
                                <label for="editTipoAccesorio" class="urban-label">TIPO DE ACCESORIO</label>
                                <select class="form-select urban-select" id="editTipoAccesorio" name="tipo_accesorio">
                                    <option value="REL">Reloj</option>
                                    <option value="BUF">Bufanda</option>
                                    <option value="CIN">Cinturón</option>
                                    <option value="COL">Collar</option>
                                    <option value="GOR">Gorra</option>
                                    <option value="PUL">Pulseras</option>
                                </select>
                            </div>
                            
                            <div class="form-group mt-3">
                                <label for="editImagen" class="urban-label">ACTUALIZAR IMAGEN</label>
                                <input type="file" class="form-control urban-input" id="editImagen" name="imagen">
                                <small class="text-muted d-block mt-1">* Deja en blanco para mantener la actual</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-5 d-flex justify-content-center gap-3">
                        <button type="button" class="btn btn-secondary px-4" id="cancelEdit">CANCELAR</button>
                        <button type="submit" class="btn urban-btn px-5">GUARDAR CAMBIOS</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="urban-table-wrapper mt-5 fade-in">
            <h4 class="urban-subtitle mb-4">HISTORIAL DE ACTIVIDAD RECIENTE</h4>
            <div class="urban-card p-0 overflow-hidden">
                <div class="table-responsive">
                    <table class="table urban-table table-borderless mb-0">
                        <thead>
                            <tr>
                                <th scope="col">PRENDA MODIFICADA</th>
                                <th scope="col">TIENDA ASOCIADA</th>
                                <th scope="col">USUARIO</th>
                                <th scope="col">FECHA</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if historial %}
                                {% for registro in historial %}
                                <tr>
                                    <td class="text-urban fw-bold">{{ registro.prenda }}</td>
                                    <td>{{ registro.tienda }}</td>
                                    <td>
                                        <span class="user-badge">{{ registro.usuario.username|upper }}</span>
                                    </td>
                                    <td class="text-muted">{{ registro.fecha|date:"d/m/Y H:i" }}</td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="4" class="text-center py-4 text-muted">No hay registros de actividad reciente.</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/modificar.js' %}"></script>
{% endblock %}

