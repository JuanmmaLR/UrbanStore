{% extends "Herencia.html" %}
{% load static %}

{% block title %}25 Urban Store - Administraci√≥n de Usuarios{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<link rel="stylesheet" type="text/css" href="{% static 'style/Usuarios/Admin_User.css' %}" />
{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/Admin_User.css' %}">

<div class="admin-wrapper">
    <div class="admin-header">
        <h1>GESTI√ìN DE STAFF & USUARIOS</h1>
        <p>Asigna roles y tiendas a los usuarios registrados</p>
    </div>

    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="alert {{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="users-table-container">
        <div class="table-header">
            <div class="col-mini">ID</div>
            <div class="col-med">USUARIO</div>
            <div class="col-wide">EMAIL</div>
            <div class="col-med">NOMBRE</div>
            <div class="col-med">APELLIDO</div>
            <div class="col-mini">STAFF</div>
            <div class="col-wide">TIENDA ASIGNADA</div>
            <div class="col-actions">ACCIONES</div>
        </div>

        {% for user in users %}
        <form method="POST" class="table-row">
            {% csrf_token %}
            <input type="hidden" name="user_id" value="{{ user.id }}">
            
            <div class="col-mini centered">
                <span class="id-badge">#{{ user.id }}</span>
            </div>
            
            <div class="col-med">
                <input type="text" name="username_{{ user.id }}" value="{{ user.username }}" class="urban-input" placeholder="User">
            </div>
            
            <div class="col-wide">
                <input type="email" name="email_{{ user.id }}" value="{{ user.email }}" class="urban-input" placeholder="Email">
            </div>
            
            <div class="col-med">
                <input type="text" name="first_name_{{ user.id }}" value="{{ user.first_name }}" class="urban-input" placeholder="Nombre">
            </div>
            
            <div class="col-med">
                <input type="text" name="last_name_{{ user.id }}" value="{{ user.last_name }}" class="urban-input" placeholder="Apellido">
            </div>
            
            <div class="col-mini centered">
                <label class="switch">
                    <input type="checkbox" name="is_staff_{{ user.id }}" {% if user.is_staff %}checked{% endif %}>
                    <span class="slider round"></span>
                </label>
            </div>
            
            <div class="col-wide">
                <select name="tienda_{{ user.id }}" class="urban-select">
                    <option value="" class="default-option">üë§ Cliente (Sin Tienda)</option>
                    {% for tienda in tiendas %}
                        <option value="{{ tienda.id }}" 
                            {% if user.preferencias.tienda_asociada and user.preferencias.tienda_asociada.id == tienda.id %}selected{% endif %}>
                            üè¢ {{ tienda.nombre_tienda }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="col-actions centered">
                <button type="submit" name="update_user" class="btn-icon btn-update" title="Guardar Cambios">
                    <i class="fas fa-save"></i> 
                </button>
                <button type="submit" name="delete_user" class="btn-icon btn-delete" title="Eliminar Usuario" onclick="return confirm('¬øEst√°s seguro de eliminar a este usuario?');">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </form>
        {% empty %}
        <div class="no-data">
            <p>No hay usuarios registrados en el sistema.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/Usuarios/Admin_User.js' %}"></script>
{% endblock %}